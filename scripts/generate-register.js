#! /usr/bin/env node

const fs = require('fs')
const path = require('path')
const _ = require('lodash')
const argv = require('yargs').argv

const cwd = process.cwd()

const folder = argv.src || cwd
const ext = argv.ext || 'js'
const dest = argv.dest || cwd

const fileList = fs.readdirSync(folder)

const transform = (files) => { 
  const message = `/***\n* This file is autogenerated, please do not edit it.\n* To generate an updated version, please run \`yarn genreg\`\n***/\n\n`
  let output = files.map(file => {
    const match = `.${ext}`
    const re = new RegExp(match, 'gi')
    // Only look for requested files
    if (file.match(re) && !file.match('index')) {
      const fileNoExt = file.replace(re, '')
      const varName = _.upperFirst(_.camelCase(fileNoExt))
      return `export { default as ${varName} } from './${fileNoExt}'`
    }
  })
  return message + output.filter(function (el) {
    return el != null;
  }).toString().replace(/,/g, '\n')
}

fs.writeFileSync(path.resolve(dest, `index.${ext}`), transform(fileList))